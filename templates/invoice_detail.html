{% extends 'base.html' %}
{% load static %}

{% block title %}Chi tiết hóa đơn {{ invoice.invoice_id }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/invoices.css' %}">
{% endblock %}

{% block header_icon %}
<a href="{% url 'get_all_invoices' %}" style="text-decoration: none; color: inherit; margin-right: 10px;">
    <i class="fa-solid fa-arrow-left"></i>
</a>
<i class="fa-solid fa-file-invoice"></i>
{% endblock %}
{% block header_title %}Chi tiết hóa đơn{% endblock %}

{% block content %}
<div class="detail-container">
    <div class="detail-header">
        <div>
            <h2>Hóa đơn {{ invoice.invoice_id }}</h2>
            {% if invoice.invoice_title %}
            <p style="color: #64748b; margin-top: 5px;">{{ invoice.invoice_title }}</p>
            {% endif %}
        </div>
        <span class="status-badge-large status-{{ invoice.status }}">
            {% if invoice.status == 'paid' %}Đã thanh toán
            {% elif invoice.status == 'unpaid' %}Chưa thanh toán
            {% else %}Quá hạn{% endif %}
        </span>
    </div>

    <!-- Section: Thông tin hóa đơn -->
    <div class="info-section">
        <h3><i class="fa-solid fa-file-invoice-dollar"></i> Thông tin hóa đơn</h3>
        <div class="info-grid">
            <div class="info-item">
                <label>Mã hóa đơn</label>
                <span>{{ invoice.invoice_id }}</span>
            </div>
            <div class="info-item">
                <label>Loại dịch vụ</label>
                <span>{{ invoice.get_service_display }}</span>
            </div>
            <div class="info-item">
                <label>Ngày thu phí</label>
                <span>{{ invoice.start_date|date:"d/m/Y" }}</span>
            </div>
            <div class="info-item">
                <label>Ngày hết hạn</label>
                <span>{{ invoice.end_date|date:"d/m/Y"|default:"--" }}</span>
            </div>
            <div class="info-item">
                <label>Ngày thanh toán</label>
                <span>{{ invoice.date|date:"d/m/Y"|default:"--" }}</span>
            </div>
            <div class="info-item">
                <label>Trạng thái</label>
                <span class="status-badge status-{{ invoice.status }}">
                    {% if invoice.status == 'paid' %}Đã thanh toán
                    {% elif invoice.status == 'unpaid' %}Chưa thanh toán
                    {% else %}Quá hạn{% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Section: Thông tin phòng -->
    <div class="info-section">
        <h3><i class="fa-solid fa-door-open"></i> Thông tin phòng</h3>
        <div class="info-grid">
            <div class="info-item">
                <label>Tòa nhà</label>
                <span>{{ invoice.room.building.name }}</span>
            </div>
            <div class="info-item">
                <label>Số phòng</label>
                <span>{{ invoice.room.room_number }}</span>
            </div>
            {% if invoice.resident %}
            <div class="info-item">
                <label>Chủ hộ</label>
                <span>{{ invoice.resident.last_name }} {{ invoice.resident.first_name }}</span>
            </div>
            {% endif %}
            {% if invoice.contract %}
            <div class="info-item">
                <label>Mã hợp đồng</label>
                <span>{{ invoice.contract.contract_id }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Section: Thông tin tài chính -->
    <div class="info-section">
        <h3><i class="fa-solid fa-money-bill-wave"></i> Thông tin tài chính</h3>
        <div class="info-grid">
            <div class="info-item">
                <label>Số lượng đơn vị</label>
                <span>{{ invoice.count_unit }}</span>
            </div>
            <div class="info-item">
                <label>Đơn giá</label>
                <span>{{ invoice.unit_price|floatformat:0 }} VNĐ</span>
            </div>
            <div class="info-item" style="grid-column: span 2;">
                <label>Tổng tiền</label>
                <span style="color: var(--primary-color); font-weight: bold; font-size: 24px;">{{ invoice.total_price|floatformat:0 }} VNĐ</span>
            </div>
        </div>
    </div>

    <div class="detail-actions">
        <a href="{% url 'get_all_invoices' %}" class="btn-secondary" style="text-decoration: none; display: flex; align-items: center; justify-content: center;">Quay lại</a>
        {% if invoice.status != 'paid' %}
        <form method="POST" action="{% url 'mark_invoice_paid' invoice_id=invoice.invoice_id %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn-success" style="padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <i class="fa-solid fa-check-circle"></i> Đánh dấu đã thanh toán
            </button>
        </form>
        {% endif %}
        <a href="{% url 'update_invoice' invoice_id=invoice.invoice_id %}" class="btn-primary" style="text-decoration: none; display: flex; align-items: center; gap: 8px;">
            <i class="fa-solid fa-edit"></i> Chỉnh sửa
        </a>
    </div>
</div>
{% endblock %}
